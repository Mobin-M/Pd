#N canvas 52 20 1854 977 12;
#X text 31 12 VERSION 0;
#X msg 564 235 30 110;
#X text 686 283 Recording incoming MIDI;
#X msg 926 30 line 0 \, auto;
#X text 593 208 CC;
#X text 614 235 Note;
#X obj 670 231 r \$0-i-bar;
#X obj 670 256 bng 20 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 926 81 unpack f f;
#X msg 553 210 45 1;
#N canvas 853 130 670 854 recording-unit 0;
#X obj 426 109 tgl 20 0 empty empty GO 23 10 0 12 #fcfcfc #000000 #000000 0 1;
#X obj 426 212 bng 20 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 426 237 f;
#X floatatom 426 262 12 0 0 1 ms - - 0;
#X obj 426 134 sel 1 0, f 11;
#X msg 426 159 1;
#X msg 463 159 0;
#X obj 426 85 spigot;
#X obj 480 85 tgl 20 0 empty empty rec-queue 23 10 0 12 #fcfcfc #000000 #000000 0 1;
#X obj 310 112 spigot;
#X text 491 187 Resolution:25ms;
#X obj 310 368 pack f f f;
#X obj 377 287 f;
#X msg 390 174 0, f 2;
#X floatatom 377 310 5 0 0 0 - - - 0;
#X obj 519 155 s \$0-rec-queue;
#X obj 480 58 r \$0-i-rec-queue;
#X msg 519 132 set \$1;
#X obj 310 23 inlet;
#X obj 426 22 inlet;
#X text 43 564 With Rec-Queue \; - wait for right inlet (a bang \, specifying beginning of first bar) \; - with bang recieved \, timer starts \; - each time midi info arrives \, this subpatch packs it with timing information showing time passed since begining of the first bar or previous midi in and outputs it \; - with the next first bar back recording and timer turn off \;, f 69;
#X obj 310 344 f;
#X obj 310 140 t b l b, f 10;
#X obj 393 53 bng 20 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X msg 324 52 10 127;
#X obj 321 309 unpack;
#X text 44 686 IO \; - left inlet (list of 2) \; ** Key ON/OFF \, velocity \; ** Knob \, Value \; - Right inlet(bang) \; ** 1'st bar start \; - outlet (list of 3) \; ** time-passed \, key/knob \, velocity/value \;, f 45;
#X obj 426 187 metro 10;
#X obj 456 237 + 10;
#X text 352 23 midiinfo;
#X text 469 22 bar(rec) start;
#X listbox 104 124 20 0 0 0 - - - 0;
#X msg 317 487 -1;
#X obj 317 460 bng 20 250 50 0 empty \$0-i-clear Clear-Sequence 23 10 0 12 #fcfcfc #000000 #000000;
#X obj 317 512 text delete \$0-sequence-note-trig;
#X obj 310 396 text insert \$0-sequence-note-trig 1e+09;
#X connect 0 0 4 0;
#X connect 0 0 9 1;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 2 0 28 0;
#X connect 3 0 12 1;
#X connect 4 0 5 0;
#X connect 4 1 6 0;
#X connect 5 0 27 0;
#X connect 6 0 2 1;
#X connect 6 0 8 0;
#X connect 6 0 27 0;
#X connect 7 0 0 0;
#X connect 8 0 7 1;
#X connect 8 0 17 0;
#X connect 9 0 22 0;
#X connect 11 0 31 0;
#X connect 11 0 35 0;
#X connect 12 0 14 0;
#X connect 13 0 2 1;
#X connect 14 0 21 1;
#X connect 16 0 8 0;
#X connect 17 0 15 0;
#X connect 18 0 9 0;
#X connect 19 0 7 0;
#X connect 21 0 11 0;
#X connect 22 0 21 0;
#X connect 22 1 25 0;
#X connect 22 2 13 0;
#X connect 22 2 12 0;
#X connect 23 0 7 0;
#X connect 24 0 9 0;
#X connect 25 0 11 1;
#X connect 25 1 11 2;
#X connect 27 0 1 0;
#X connect 28 0 2 1;
#X connect 32 0 34 0;
#X connect 33 0 32 0;
#X coords 0 -1 1 1 150 50 1 100 100;
#X restore 527 283 pd recording-unit;
#X obj 248 85 text define -k \$0-sequence-CC-velocity;
#A set;
#X obj 248 109 text define -k \$0-sequence-CC-1;
#A set;
#X obj 248 133 text define -k \$0-sequence-CC-2;
#A set;
#X obj 248 61 text define -k \$0-sequence-note-trig;
#A set;
#X obj 926 56 text sequence \$0-sequence-note-trig -w 1;
#X obj 601 27 text define -k notes;
#A set ** timer/realtime do not work here since there is no toggle to stop them. Easy to do this with a counter with desired precision (10ms) with metro 10 \; \; \; ** in general since I am not good at finger drumming \, velocity should be considered constant or discarded and hard-coded with possibility of modification using a CC \; For oneshot sequencer \; - duration of holding the note does not matter \; - velocity should be constant with a CC \; For note sequencer \; - duration is important for ADSR \; - aftertouch could be useful \; \; \; Need to keep textfile closed \, otherwise might experience lag/buginess \;;
#X text 181 9 Realtime sequencer: for One-shot input;
#X connect 1 0 10 0;
#X connect 3 0 15 0;
#X connect 6 0 7 0;
#X connect 7 0 10 1;
#X connect 9 0 10 0;
#X connect 15 0 8 0;
